{"version":3,"file":"CurrencyInputField-Rf87MPT4.js","sources":["../../src/field/CurrencyInputField.tsx"],"sourcesContent":["import \"../form/formSupport\";\n\nimport { InputDomRef, ValueState } from \"@ui5/webcomponents-react\";\nimport {\n  FC,\n  forwardRef,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n} from \"react\";\nimport { useController, useFormContext } from \"react-hook-form\";\n\nimport {\n  CurrencyInput,\n  CurrencyInputProps,\n} from \"../component/number/CurrencyInput\";\nimport { useI18nValidationError } from \"../i18n/FormI18n\";\nimport { FormFieldElement, FormFieldValidation } from \"./types\";\nimport { hasError } from \"./util\";\n\nexport type CurrencyInputFieldProps = Omit<\n  CurrencyInputProps,\n  \"name\" | \"value\" | \"onChange\" | \"valueState\" | \"onBlur\"\n> &\n  Pick<FormFieldValidation, \"required\" | \"min\" | \"max\"> & {\n    name: string;\n  };\n\nexport const CurrencyInputField = forwardRef<\n  FormFieldElement,\n  CurrencyInputFieldProps\n>(({ name, required, min, max, ...props }, forwardedRef) => {\n  const rules: Partial<FormFieldValidation> = useMemo(\n    () => ({\n      required,\n      min,\n      max,\n    }),\n    [required, min, max]\n  );\n\n  const getValidationErrorMessage = useI18nValidationError(name, rules);\n\n  const { field, fieldState } = useController({ name, rules });\n  const { clearErrors } = useFormContext();\n\n  // store input ref for intenral usage\n  const internalRef = useRef<InputDomRef>(null);\n  // forward outer ref to custom element\n  useImperativeHandle(forwardedRef, () => ({\n    focus() {\n      if (internalRef.current != null) {\n        internalRef.current.focus();\n      }\n    },\n  }));\n  // forward field ref to stored internal input ref\n  useImperativeHandle(field.ref, () => internalRef.current);\n\n  // use empty string to reset value, undefined will be ignored by web component\n  const value = field.value;\n\n  // get error message (Note: undefined fallbacks to default message of ui5 component)\n  const errorMessage = hasError(fieldState.error)\n    ? getValidationErrorMessage(fieldState.error, field.value)\n    : undefined;\n\n  // clear error on first change\n  const onKeyUp = useCallback(() => {\n    clearErrors(name);\n  }, [clearErrors, name]);\n\n  return (\n    <CurrencyInput\n      {...props}\n      ref={internalRef}\n      name={field.name}\n      value={value}\n      onChange={(_, val) => {\n        field.onChange(val);\n      }}\n      onBlur={field.onBlur}\n      required={required}\n      valueState={\n        hasError(fieldState.error) ? ValueState.Error : ValueState.None\n      }\n      valueStateMessage={\n        errorMessage != null && (\n          <div slot=\"valueStateMessage\">{errorMessage}</div>\n        )\n      }\n      aria-valuemin={\n        min != null ? (typeof min === \"number\" ? min : min.value) : undefined\n      }\n      aria-valuemax={\n        max != null ? (typeof max === \"number\" ? max : max.value) : undefined\n      }\n      onKeyUp={hasError(fieldState.error) ? onKeyUp : undefined}\n    />\n  );\n});\n"],"names":["CurrencyInputField","forwardRef","name","required","min","max","props","forwardedRef","rules","useMemo","getValidationErrorMessage","useI18nValidationError","field","fieldState","useController","clearErrors","useFormContext","internalRef","useRef","useImperativeHandle","value","errorMessage","hasError","onKeyUp","useCallback","jsx","CurrencyInput","_","val","ValueState"],"mappings":"gXA6BO,MAAAA,EAAAC,EAAAA,WAAA,CAAA,CAAA,KAAAC,EAAA,SAAAC,EAAA,IAAAC,EAAA,IAAAC,EAAA,GAAAC,CAAA,EAAAC,IAAA,CAIL,MAAAC,EAAAC,EAAA,QAA4C,KAAA,CACnC,SAAAN,EACL,IAAAC,EACA,IAAAC,CACA,GACF,CAAAF,EAAAC,EAAAC,CAAA,CACmB,EAGrBK,EAAAC,EAAAT,EAAAM,CAAA,EAEA,CAAA,MAAAI,EAAA,WAAAC,CAAA,EAAAC,EAAA,CAAA,KAAAZ,EAAA,MAAAM,CAAA,CAAA,EACA,CAAA,YAAAO,GAAAC,IAGAC,EAAAC,SAAA,IAAA,EAEAC,EAAA,oBAAAZ,EAAA,KAAA,CAAyC,OAAA,CAErCU,EAAA,SAAA,MACEA,EAAA,QAAA,OACF,CACF,EAAA,EAGFE,EAAAA,oBAAAP,EAAA,IAAA,IAAAK,EAAA,OAAA,EAGA,MAAAG,EAAAR,EAAA,MAGAS,EAAAC,EAAAT,EAAA,KAAA,EAAAH,EAAAG,EAAA,MAAAD,EAAA,KAAA,EAAA,OAKAW,EAAAC,EAAAA,YAAA,IAAA,CACET,EAAAb,CAAA,CAAgB,EAAA,CAAAa,EAAAb,CAAA,CAAA,EAGlB,OAAAuB,EACEC,EAAC,CAAA,GAAApB,EACK,IAAAW,EACC,KAAAL,EAAA,KACO,MAAAQ,EACZ,SAAA,CAAAO,EAAAC,IAAA,CAEEhB,EAAA,SAAAgB,CAAA,CAAkB,EACpB,OAAAhB,EAAA,OACc,SAAAT,EACd,WAAAmB,EAAAT,EAAA,KAAA,EAAAgB,EAAA,MAAAA,EAAA,KAE6D,kBAAAR,GAAA,MAAAI,EAAA,MAAA,CAAA,KAAA,oBAAA,SAAAJ,EAAA,EAIb,gBAAAjB,GAAA,KAAA,OAAAA,GAAA,SAAAA,EAAAA,EAAA,MAAA,OAIc,gBAAAC,GAAA,KAAA,OAAAA,GAAA,SAAAA,EAAAA,EAAA,MAAA,OAGA,QAAAiB,EAAAT,EAAA,KAAA,EAAAU,EAAA,MAEd,CAAA,CAGtD,CAAA;;;;;;;;;;;;;;;;;;"}